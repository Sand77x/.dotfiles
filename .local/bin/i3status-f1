#!/bin/bash
exec="$HOME/Projects/i3status/i3status-f1/get-next.sh"
file="$HOME/.cache/get-next-f1/next_session"

output="$($exec)"
if [ "$output" = "Season done!" ]; then
    echo "Race: $output" > "$file"
    exit
fi

read loc sesh ts <<< "$output"

now=$(date +%s)
diff=$(( ts - now ))
days=$(( diff / 86400 ))
hours=$(( (diff % 86400) / 3600 ))
mins=$(( (diff % 3600) / 60 ))

diff_str=""
(( days > 0 )) && diff_str+="${days}d"
(( hours > 0 )) && diff_str+="${hours}h"
diff_str+="${mins}m"

content="Race: $loc in $diff_str ($sesh)"

if (( days <= 3 )); then
    content="<span color=\"#ee8b2b\">$content</span>"
fi

echo "$content" > "$file"
